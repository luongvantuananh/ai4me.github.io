<!DOCTYPE html>
<html>
  <head>
    <title>Hướng Dẫn Cài Đặt Và Sử Dụng Các Mô Hình OCR cho Tiếng Việt – Tuan Anh – AI Engineer/ Data Scientist</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Cài đặt các mô hình pretrained cho tiếng việt như EasyOCR, TranformerOCR, Tesseract, …

" />
    <meta property="og:description" content="Cài đặt các mô hình pretrained cho tiếng việt như EasyOCR, TranformerOCR, Tesseract, …

" />
    
    <meta name="author" content="Tuan Anh" />

    
    <meta property="og:title" content="Hướng Dẫn Cài Đặt Và Sử Dụng Các Mô Hình OCR cho Tiếng Việt" />
    <meta property="twitter:title" content="Hướng Dẫn Cài Đặt Và Sử Dụng Các Mô Hình OCR cho Tiếng Việt" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Tuan Anh - AI Engineer/ Data Scientist" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/images/luffy.jpeg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Tuan Anh</a></h1>
            <p class="site-description">AI Engineer/ Data Scientist</p>
          </div>







          <nav>


            <a href="/"><b>Blog</b></a>
<!--            <a href="/datascientist"><b>Data Scientist</b></a>-->
<!--            <a href="/deeplearning"><b>Deep Learning</b></a>-->
            <a href="/tailieu"><b>Tài Liệu</b></a>
            <a href="/about"><b>About</b></a>
            <a href="/resume"><b>Resume</b></a>
          </nav>


        </header>
        <div>
          <nav>
              <a href="/deeplearning"><b style="color:blue;">Deep Learning</b></a>
              <a href="/computervision"><b style="color:blue;">Computer Vision</b></a>
              <a href="/bigdata"><b style="color:blue;">Big Data</b></a>
          </nav>
        </div>
        <br>
        <br>
        <br>

      </div>

    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Hướng Dẫn Cài Đặt Và Sử Dụng Các Mô Hình OCR cho Tiếng Việt</h1>

  <div class="entry">
    <p>Cài đặt các mô hình pretrained cho tiếng việt như EasyOCR, TranformerOCR, Tesseract, …</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/ocr.jpg" height="700" />
</div>

<p>Trong bài viết này, mình sẽ giới thiệu và hướng dẫn cài đặt các mô hình OCR được train sẵn cho tiếng việt để mọi người
cũng như mình có thể dễ dàng sử dụng. Mà mình cũng nói trước nhé, các mô hình này được thiết kế để ăn sẵn, nó sẽ tốt với
bộ dữ liệu giống với bộ dữ liệu training set của họ(thường là data đẹp ), còn nếu muốn nâng cao lên với các trường hợp
ảnh khó hơn thì không có cách nào khác là tự xây dựng riêng cho mình một model OCR.</p>

<p>Các mô hình mình sử dụng sẽ được dẫn link ở cuối bài, nếu tác giả muốn gỡ thì hãy liên lạc với mình nha
(chắc không có đâu nhưng cứ lo xa chút :vv). Thôi mình không lan man nữa, bắt đầu nào :)))</p>

<p>Bài viết của mình sẽ gồm các phần như sau :</p>

<p><strong>1. OCR là gì?</strong></p>

<p><strong>2. TesseractOCR</strong></p>

<p><strong>3. EasyOCR</strong></p>

<p><strong>4. TransformerOCR (VietOCR)</strong></p>

<p><strong>5. Updating …</strong></p>

<h1 id="chi-tiết-nội-dung-"><strong><em>Chi tiết nội dung</em></strong> :</h1>

<h2 id="1-ocr-là-gì">1. OCR là gì?</h2>

<p>OCR là từ viết tắt của optical character recognition, được dịch sang tiếng việt là nhận diện ký tự quang học, hiểu nôm
na là nó sẽ dự đoán xem ảnh input vào có chứa chữ gì như ví dụ sau:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/cmnd.png" />
</div>

<p><strong>===&gt; OUTPUT: 015071000030</strong></p>

<h3 id="ứng-dụng-của-ocr-là-gì-">Ứng dụng của OCR là gì ?</h3>

<p>Ứng dụng của OCR thì nhiều vô kể, miễn là trong ảnh chứa thông tin liên quan đến text 
thì output sẽ là nội dung của đoạn text đó:</p>
<ul>
  <li>Nhận diện thông tin cá nhân từ chứng minh nhân dân, thẻ căn cước, bằng lái xe, hộ chiếu, …</li>
  <li>Đọc giá trị của công tơ điện từ ảnh chụp.</li>
  <li>Nhận diện biển số xe, phát hiện từ khóa,..</li>
</ul>

<h2 id="2-tesseract">2. Tesseract</h2>
<p>Tesseract là ứng dụng OCR mã nguồn mở được tài trợ bằng Google. 
Nó hỗ trợ tốt nhất cho văn bản các văn bản tdf trong điều kiện read-only ( Không thể sao chép trực tiếp nội dung) .
Có thể sử dụng trực tiếp bằng code hoặc thông qua API.</p>

<p>Tesseract được phát triển để chạy trên cả 3 hệ điều hành phổ biến hiện nay như Window, 
Mac và Linux. Nó hỗ trợ trên 100 ngôn ngũo gồm khác nhau bao gồm cả tiếng việt.</p>

<h3 id="21-hướng-dẫn-cài-đặt">2.1 Hướng dẫn cài đặt</h3>

<p>Mình sẽ hướng dẫn cài đặt để sử dụng với python và linux nhé các bạn:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>tesseract-ocr
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_install_1.png" />
</div>

<p>Tiếp tục</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>pip <span class="nb">install </span>pytesseract
</code></pre></div></div>
<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_install_2.png" />
</div>

<p>Download <a href="https://github.com/tesseract-ocr/tessdata/blob/master/vie.traineddata">pretrained cho tiếng việt</a>
, rồi copy sang thư mục như sau:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo cp </span>vie.traineddata /usr/share/tesseract-ocr/4.00/tessdata/
</code></pre></div></div>

<h3 id="22-thử-nghiệm">2.2 Thử nghiệm</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">pytesseract</span>

<span class="c1"># Load image
</span><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'17-35-29.png'</span><span class="p">)</span>

<span class="c1"># Convert raw image -&gt; Binaray image
</span><span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="p">.</span><span class="n">THRESH_OTSU</span><span class="p">)</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">gray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Image To Text
</span><span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">'vie'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>Ảnh đầu vào :</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_input.png" />
</div>

<p>Output:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_output.png" />
</div>

<h2 id="3-easyocr">3. EasyOCR</h2>
<p>EasyOCR là mô hình pretrained được hỗ trợ với 70+ ngôn ngữ khác nhau, danh sách ngôn ngữ được hỗ trợ có thể xem tại []
(https://www.jaided.ai/easyocr)</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_pipline.jpeg" />
</div>

<h3 id="31-hướng-dẫn-cài-đặt">3.1 Hướng dẫn cài đặt</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>pip <span class="nb">install </span>easyocr
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_install.png" />
</div>

<p>Lưu ý, trong đoạn code easyocr.Reader([‘en’, ‘vi’]), bạn có thể chọn 1 hoặc nhiều hơn một ngôn ngữ để phát hiện.</p>

<h3 id="32-thực-nghiệm">3.2 Thực nghiệm</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">easyocr</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">easyocr</span><span class="p">.</span><span class="n">Reader</span><span class="p">([</span><span class="s">'en'</span><span class="p">,</span> <span class="s">'vi'</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readtext</span><span class="p">(</span><span class="s">'17-35-29.png'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_input.png" />
</div>

<p>Kết quả:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_output.png" />
</div>

<h2 id="4-transformerocr-vietocr">4. TransformerOCR (VietOCR)</h2>

<p>Phương pháp này được xây dựng từ tác giả Phạm Bá Cường Quốc, vì trong blog này tác giả đã trình bày chi tiết về thuật toán cũng như so sánh ưu nhược điểm với phương pháp AttentionOCR hay CRNN+CTC Loss rồi nên mình sẽ không nói lại quá nhiều. Có thể hiểu đại ý như sau:</p>

<ul>
  <li>Phương pháp OCR thông thường là CNN + LSTM, mô hình cắt ảnh thì nhiều phần nhỏ theo chiều dọc, mỗi phần đó được đưa qua một mạng CNN nào đó (ở đây tác giả dùng VGG) để ra được 1 feature đặc trưng, rồi cho một list feature đó qua LSTM để dự đoán các kí tự trong ảnh.</li>
</ul>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_pipline.jpeg" />
</div>

<ul>
  <li>Phương pháp TransformerOCR cải tiến hơn bằng cách thay thế LSTM bằng một mô hình transformer (là mô hình nền tảng của BERT khá nổi tiếng).</li>
</ul>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_pipline_2.jpeg" />
</div>

<ul>
  <li>Ngoài ra phương pháp TransformerOCR sử dụng CrossEntropyLoss thay vì sử dụng CTC Loss do phương pháp CTC Loss có nhiều hạn chế.</li>
</ul>

<h3 id="41-hướng-dẫn-cài-đặt">4.1 Hướng dẫn cài đặt</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">pip install vietocr==0.3.5
</span></code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_install.png" />
</div>

<h3 id="42-thử-nghiệm">4.2 Thử nghiệm</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">vietocr.tool.predictor</span> <span class="kn">import</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">vietocr.tool.config</span> <span class="kn">import</span> <span class="n">Cfg</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># sử dụng config của các bạn được export lúc train nếu đã thay đổi 
# tham số
# config = Cfg.load_config_from_file('config.yml')
# sử dụng config mặc định của mô hình
</span><span class="n">config</span> <span class="o">=</span> <span class="n">Cfg</span><span class="p">.</span><span class="n">load_config_from_name</span><span class="p">(</span><span class="s">'vgg_transformer'</span><span class="p">)</span>
<span class="c1"># đường dẫn đến trọng số đã huấn luyện hoặc comment để sử dụng 
#pretrained model mặc định
</span><span class="n">config</span><span class="p">[</span><span class="s">'weights'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'transformerocr.pth'</span>
<span class="n">config</span><span class="p">[</span><span class="s">'device'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'cpu'</span> <span class="c1"># device chạy 'cuda:0', 'cuda:1', 'cpu'
</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">Predictor</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="s">'17-35-29.png'</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c1"># dự đoán 
# muốn trả về xác suất của câu dự đoán thì đổi return_prob=True
</span><span class="n">s</span> <span class="o">=</span> <span class="n">detector</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">return_prob</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'TEXT OUTPUT: '</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_input.png" />
</div>

<p>Kết quả:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_output.png" />
</div>

<p>Một số lưu ý từ tác giả :</p>
<ul>
  <li>Phương pháp TransformerOCR dù được sử dụng công nghệ hiện đại nhưng chưa cải tiến quá nhiều so với phương pháp SOTA trước đó như AttentionOCR mà lại có thời gian dự đoán chậm hơn khá nhiều.</li>
  <li>Pretrained model được huấn luyện với 10m ảnh chữ in nên nếu muốn sử dụng trong hệ thống product thực tế của bạn thì cần phải training thêm</li>
</ul>

<h1 id="updating-">Updating …</h1>

<h1 id="nguồn">Nguồn</h1>

<ul>
  <li>https://pbcquoc.github.io/vietocr/</li>
  <li>https://github.com/pbcquoc/vietocr</li>
  <li>https://github.com/JaidedAI/EasyOCR</li>
  <li>https://tesseract-ocr.github.io/</li>
</ul>

  </div>

  <div class="date">
    Written on December 30, 2020
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'luongvantuananh-github-io';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:tuananhhd5596@gmail.com"><i class="svg-icon email"></i></a>
<a href="https://www.facebook.com/TraDa"><i class="svg-icon facebook"></i></a>

<a href="https://github.com/luongvantuananh"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/jekyllrb"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>

    

  </body>
</html>
